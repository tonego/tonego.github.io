-- 《etcd实战课》
 开篇词｜为什么你要学习etcd?
 我希望你能够用最低的学习成本，掌握etcd核心原理和最佳实践，让etcd为你所用。
 
### 01 | etcd的前世今生：为什么Kubernetes使用etcd？
 
### 02 | 基础架构：etcd一个读请求是如何执行的？
Client层。包括 client v2 和 v3 两个大版本 API 客户端库，提供了简洁易用的 API，同时支持负载均衡、节点间故障自动转移，可极大降低业务使用 etcd 复杂度，提升开发效率、服务可用性。
API网络层。主要包括 client 访问 server 和 server 节点之间的通信协议。一方面，client 访问 etcd server 的 API 分为 v2 和 v3 两个大版本。v2 API 使用 HTTP/1.x 协议，v3 API 使用 gRPC 协议。同时 v3 通过 etcd grpc-gateway 组件也支持 HTTP/1.x 协议，便于各种语言的服务调用。另一方面，server 之间通信协议，是指节点间通过 Raft 算法实现数据复制和 Leader 选举等功能时使用的 HTTP 协议。
Raft算法层。实现了 Leader 选举、日志复制、ReadIndex 等核心算法特性，用于保障 etcd 多个节点间的数据一致性、提升服务可用性等，是 etcd 的基石和亮点。
功能逻辑层。etcd 核心特性实现层，如典型的 KVServer 模块、MVCC 模块、Auth 鉴权模块、Lease 租约模块、Compactor 压缩模块等，其中 MVCC 模块主要由 treeIndex 模块和 boltdb 模块组成。
存储层。存储层包含预写日志 (WAL) 模块、快照 (Snapshot) 模块、boltdb 模块。其中 WAL 可保障 etcd crash 后数据不丢失，boltdb 则保存了集群元数据和用户写入的数据。
KVServer。
拦截器：debug日志、metrics统计、Learner节点api和参数控制、要求操作前必须有leader防止脑裂、慢查询日志。
串行读：数据不一致、递延税、高吞吐。 线性读：要leader的index，等待状态机追上leader进度。
MVCC。 从 treeIndex （b-tree）中获取 key hello 的版本号，再以版本号作为 boltdb 的 key，从 boltdb （b+tree）中获取其 value 信息。
小结。一个读请求从 client 通过 Round-robin 负载均衡算法，选择一个 etcd server 节点，发出 gRPC 请求，经过 etcd server 的 KVServer 模块、线性读模块、MVCC 的 treeIndex 和 boltdb 模块紧密协作，完成了一个读请求。
早期 etcd 线性读使用的 Raft log read，也就是说把读请求像写请求一样走一遍 Raft 的协议，基于 Raft 的日志的有序性，实现线性读。但此方案读涉及磁盘 IO 开销，性能较差，后来实现了 ReadIndex 读机制来提升读性能，满足了 Kubernetes 等业务的诉求。
 
### 03 | 基础架构：etcd一个写请求是如何执行的？
 
### 04 | Raft协议：etcd如何实现高可用、数据强一致的？
 
### 05 | 鉴权：如何保护你的数据安全？
### 今天这节课，我将为你介绍etcd的鉴权模块，深入剖析etcd如何解决上面的这些痛点和挑战。

### 06 | 租约：如何检测你的客户端存活？
### 希望通过本节让你对Lease如何关联key、Lease如何高效续期、淘汰、什么是checkpoint机制有深入的理解。

### 07 | MVCC：如何实现多版本并发控制？
### 希望通过本节课，帮助你搞懂MVCC含义和MVCC机制下key-value数据的更新、查询、删除原理

### 08 | Watch：如何高效获取数据变化通知？
### 希望通过这节课，你能在实际业务中应用Watch特性，快速获取数据变更通知。

### 09 | 事务：如何安全地实现多key操作？
### 通过转账案例为你剖析etcd事务实现，让你了解etcd如何实现事务ACID特性，以及MVCC版本号在事务中的重要作用。

### 10 | boltdb：如何持久化存储你的key-value数据？
### 今天我将通过一个写请求在boltdb中执行的简要流程，分析其背后的boltdb的磁盘文件布局。

### 11 | 压缩：如何回收旧版本数据？
### 希望通过今天的这节课，能帮助你理解etcd压缩原理，在使用etcd过程中能根据自己的业务场景，选择适合的压缩策略。

### 12 | 一致性：为什么基于Raft实现的etcd还会出现数据不一致？
### 希望通过这节课，帮助你搞懂为什么基于Raft实现的etcd有可能出现数据不一致，以及我们应该如何提前规避、预防类似问题。

### 13 | db大小：为什么etcd社区建议db大小不超过8G？
### 我将通过一个大数据量的etcd集群为案例，为你剖析etcd db大小配额限制背后的设计思考和过大的db潜在隐患。

### 14 | 延时：为什么你的etcd请求会出现超时？
### 希望通过这节课，帮助你掌握etcd延时抖动、超时背后的常见原因和分析方法。

### 15 | 内存：为什么你的etcd内存占用那么高？
### 希望通过这节课，帮助你掌握etcd内存抖动、异常背后的常见原因和分析方法，当你遇到类似问题时，能独立定位、解决。

### 16 | 性能及稳定性（上）：如何优化及扩展etcd性能？
### 希望你通过本文当遇到读etcd性能问题时，能从请求执行链路去分析瓶颈，解决问题，让业务和etcd跑得更稳、更快。

### 17 | 性能及稳定性（下）：如何优化及扩展etcd性能?
### 这节课我将通过写性能分析链路图，为你从上至下分析影响写性能、稳定性的若干因素，为你总结出etcd写性能优化和扩展方法。

### 18 | 实战：如何基于Raft从0到1构建一个支持多存储引擎分布式KV服务？
### 希望通过metcd这个小小的实战项目，能够帮助你进一步理解etcd乃至分布式存储服务的核心架构、原理、典型问题解决方案。

### 19 | Kubernetes基础应用：创建一个Pod背后etcd发生了什么？
### 希望通过本节课，让你知道在Kubernetes集群中每一步操作的背后etcd会发生什么。

### 20 | Kubernetes高级应用：如何优化业务场景使etcd能支撑上万节点集群？
### 当你遇到etcd性能瓶颈时，希望这节课介绍能让你获得启发，帮助你解决类似问题。

### 21 | 分布式锁：为什么基于etcd实现分布式锁比Redis锁更安全？
### 希望通过这节课，让你了解etcd分布式锁的应用场景、核心原理。

### 22 | 配置及服务发现：解析etcd在API Gateway开源项目中应用
### 希望通过这节课，让你了解etcd在配置系统和服务发现场景工作原理，帮助你选型适合业务场景的配置系统、服务发现组件。

### 23 | 选型：etcd/ZooKeeper/Consul等我们该如何选择？
### 今天我将带你了解主要分布式协调服务的基本原理和彼此之间的差异性。

### 24 | 运维：如何构建高可靠的etcd集群运维体系？
### 希望通过这节课，帮助你构建高可靠的etcd集群运维体系。

### 特别放送 | 成员变更：为什么集群看起来正常，移除节点却会失败呢？
### 受唐聪邀请，我将给你分享一个我前阵子遇到的有趣的故障案例，并通过这个案例来给你介绍下etcd的成员变更原理。

### 结课测试题｜这些相关etcd知识你都掌握了吗？
### 《etcd实战课》课程即将结课，来做一个小测试吧！